<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="Courier New/css?family=Lato:300,300italic,400,400italic,700,700italic|Courier New:300,300italic,400,400italic,700,700italic|bold italic:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: 'R7XREL5TXB',
      apiKey: '92daf3abe2f82662374523a7a3401255',
      indexName: 'basil_blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"搜索","hits_empty":"没有发现与「${query}」相关的结果","hits_stats":"${hits} 条相关结果，使用了 ${time} 毫秒"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="不积跬步，无以至千里；不积小流，无以成江海。">
<meta property="og:type" content="website">
<meta property="og:title" content="Basil&#39;s Blog">
<meta property="og:url" content="https://zhangbasil.github.io/index.html">
<meta property="og:site_name" content="Basil&#39;s Blog">
<meta property="og:description" content="不积跬步，无以至千里；不积小流，无以成江海。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="zhangbasil">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://zhangbasil.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Basil's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Basil's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">8</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">15</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">16</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input" id="search-input"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats" style="color:rebeccapurple"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

  
</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://zhangbasil.github.io/2020/05/02/basic/thread-local/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.jpeg">
      <meta itemprop="name" content="zhangbasil">
      <meta itemprop="description" content="不积跬步，无以至千里；</br>不积小流，无以成江海。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Basil's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/02/basic/thread-local/" class="post-title-link" itemprop="url">ThreadLocal在项目中的使用与延伸</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-02 19:05:29" itemprop="dateCreated datePublished" datetime="2020-05-02T19:05:29+08:00">2020-05-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-07 21:03:40" itemprop="dateModified" datetime="2020-05-07T21:03:40+08:00">2020-05-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index">
                    <span itemprop="name">java基础</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>对于java web开发者而言，经常需要当前登录的用户信息。而如何高效快速的获取当前登录用户的信息，业界都有多种解决方案。本次将介绍如何使用 <code>ThreadLocal</code> 来解决</p>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><ul>
<li>用户登录后将登录信息放到redis中 同时会返回一个访问用户的accessToken</li>
<li>在web 拦截器中 可以根据 accessToken 获取用户信息</li>
<li>将登录的用户信息放到 ThreadLocal 中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @author &lt;a href="mailto:hbsy_zhb@163.com"&gt;zhangbin&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PortalHandlerInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, LoginInfo&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String reqUrl = request.getRequestURI();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(reqUrl) || reqUrl.equals(<span class="string">"/"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 创建请求上下文的ThreadLocal（在当前线程内）</span></span><br><span class="line">        ReqContext context = ReqContext.getContext();</span><br><span class="line">        <span class="comment">// 从Header 里面获取accessToken</span></span><br><span class="line">        String accessToken = request.getHeader(PortalConstants.ACCESS_TOKEN);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(accessToken)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        context.setAccessToken(accessToken);</span><br><span class="line">        <span class="comment">// 根据 accessToken 获取当前登录用户的信息</span></span><br><span class="line">        LoginInfo loginInfo = redisTemplate.opsForValue().get(accessToken);</span><br><span class="line">        <span class="comment">// 将登录的用户信息放入到ThreadLocal中</span></span><br><span class="line">        context.setLoginInfo(loginInfo);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response, handler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> </span>&#123;</span><br><span class="line">        ReqContext.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href="mailto:hbsy_zhb@163.com"&gt;zhangbin&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@FieldDefaults</span>(level = AccessLevel.PRIVATE)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReqContext</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;ReqContext&gt; context = ThreadLocal.withInitial(ReqContext::<span class="keyword">new</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ReqContext <span class="title">getContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> context.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        context.remove();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String accessToken;</span><br><span class="line"></span><br><span class="line">    LoginInfo loginInfo;</span><br><span class="line"></span><br><span class="line">    Map&lt;String, ?&gt; attachment;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在后续的 控制层可以通过如下方式就可以获取用户的基本信息</span></span><br><span class="line">LoginInfo loginInfo = ReqContext.getContext().getLoginInfo();</span><br></pre></td></tr></table></figure>
<h3 id="浅析"><a href="#浅析" class="headerlink" title="浅析"></a>浅析</h3><p>通过阅读上面的代码和注释，相信读者对<code>ThreadLocal</code>也稍微有点认识了，接下来作者就简单的介绍下它</p>
<p>通过对源码了解<code>ThreadLocal</code>可以通过下面两种方式来赋值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public static &lt;S&gt; ThreadLocal&lt;S&gt; withInitial(Supplier&lt;? extends S&gt; supplier) &#123;</span><br><span class="line">    return new SuppliedThreadLocal&lt;&gt;(supplier);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public void set(T value) &#123;</span><br><span class="line">    Thread t &#x3D; Thread.currentThread();</span><br><span class="line">    ThreadLocalMap map &#x3D; getMap(t);</span><br><span class="line">    if (map !&#x3D; null)</span><br><span class="line">        map.set(this, value);</span><br><span class="line">    else</span><br><span class="line">        createMap(t, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://zhangbasil.github.io/2020/05/02/mysql/mysql8.0-Public-Key-Retrieval-is-not-allowed/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.jpeg">
      <meta itemprop="name" content="zhangbasil">
      <meta itemprop="description" content="不积跬步，无以至千里；</br>不积小流，无以成江海。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Basil's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/02/mysql/mysql8.0-Public-Key-Retrieval-is-not-allowed/" class="post-title-link" itemprop="url">mysql8.0 Public Key Retrieval is not allowed</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-02 19:05:29" itemprop="dateCreated datePublished" datetime="2020-05-02T19:05:29+08:00">2020-05-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-07 21:03:40" itemprop="dateModified" datetime="2020-05-07T21:03:40+08:00">2020-05-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="背景-amp-重现"><a href="#背景-amp-重现" class="headerlink" title="背景&amp;重现"></a>背景&amp;重现</h3><p>本地开发环境Mysql服务是放在容器docker里面，启动本地项目有时候会发现数据库链接异常如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: com.mysql.cj.exceptions.UnableToConnectException: Public Key Retrieval is not allowed</span><br></pre></td></tr></table></figure>

<p>经过几次的观察，发现只有在重启mysql服务的时候，第一次启动会有这个问题，其他的时候并没有。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>在连接的后面直接加上如下即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AllowPublicKeyRetrieval&#x3D;True</span><br></pre></td></tr></table></figure>


<p>More info: <a href="https://mysqlconnector.net/connection-options/" target="_blank" rel="noopener">connection-options</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://zhangbasil.github.io/2020/05/02/zookeeper/zookeeper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.jpeg">
      <meta itemprop="name" content="zhangbasil">
      <meta itemprop="description" content="不积跬步，无以至千里；</br>不积小流，无以成江海。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Basil's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/02/zookeeper/zookeeper/" class="post-title-link" itemprop="url">mysql8.0 Public Key Retrieval is not allowed</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-02 19:05:29" itemprop="dateCreated datePublished" datetime="2020-05-02T19:05:29+08:00">2020-05-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-07 21:03:40" itemprop="dateModified" datetime="2020-05-07T21:03:40+08:00">2020-05-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url" rel="index">
                    <span itemprop="name">中间件</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;bin&#x2F;zkServer.sh start</span><br></pre></td></tr></table></figure>
<h3 id="查看启动日志"><a href="#查看启动日志" class="headerlink" title="查看启动日志"></a>查看启动日志</h3><p>启动日志在安装的logs下面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat logs&#x2F;zookeeper-admin-server-admin.out</span><br></pre></td></tr></table></figure>

<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><ul>
<li>clientPort=2181  端口</li>
<li>dataDir=/temp/data 存储文件路径</li>
</ul>
<h3 id="zkCli-操作"><a href="#zkCli-操作" class="headerlink" title="zkCli 操作"></a>zkCli 操作</h3><h4 id="进入客户端"><a href="#进入客户端" class="headerlink" title="进入客户端"></a>进入客户端</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;bin&#x2F;zkCli.sh</span><br></pre></td></tr></table></figure>
<h4 id="递归查看节点"><a href="#递归查看节点" class="headerlink" title="递归查看节点"></a>递归查看节点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -R &#x2F;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://zhangbasil.github.io/2020/05/02/mysql/mysql-command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.jpeg">
      <meta itemprop="name" content="zhangbasil">
      <meta itemprop="description" content="不积跬步，无以至千里；</br>不积小流，无以成江海。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Basil's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/02/mysql/mysql-command/" class="post-title-link" itemprop="url">mysql相关操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-02 19:05:29" itemprop="dateCreated datePublished" datetime="2020-05-02T19:05:29+08:00">2020-05-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><h4 id="mysql-客户端命令"><a href="#mysql-客户端命令" class="headerlink" title="mysql 客户端命令"></a>mysql 客户端命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure>

<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v $PWD&#x2F;mysql&#x2F;conf.d:&#x2F;etc&#x2F;mysql&#x2F;conf.d \</span><br><span class="line">-v $PWD&#x2F;mysql&#x2F;data:&#x2F;var&#x2F;lib&#x2F;mysql \</span><br><span class="line">-e TZ&#x3D;Asia&#x2F;Shanghai \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD&#x3D;root \</span><br><span class="line">--name mysql \</span><br><span class="line">-d mysql:8.0 \</span><br><span class="line">--character-set-server&#x3D;utf8mb4 --collation-server&#x3D;utf8mb4_unicode_ci</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://zhangbasil.github.io/2020/05/02/nginx/nginx-command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.jpeg">
      <meta itemprop="name" content="zhangbasil">
      <meta itemprop="description" content="不积跬步，无以至千里；</br>不积小流，无以成江海。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Basil's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/02/nginx/nginx-command/" class="post-title-link" itemprop="url">nginx相关操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-02 19:05:29" itemprop="dateCreated datePublished" datetime="2020-05-02T19:05:29+08:00">2020-05-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/" itemprop="url" rel="index">
                    <span itemprop="name">服务器</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><h4 id="Nginx-客户端命令"><a href="#Nginx-客户端命令" class="headerlink" title="Nginx 客户端命令"></a>Nginx 客户端命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -v <span class="variable">$PWD</span>/nginx.conf:/etc/nginx/nginx.conf nginx</span><br><span class="line"></span><br><span class="line">docker run -p 80:80 -v <span class="variable">$PWD</span>/nginx.conf:/etc/nginx/nginx.conf -e TZ=Asia/Shanghai --name nginx -d nginx:stable-alpine</span><br></pre></td></tr></table></figure>

<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-v $PWD&#x2F;nginx.conf:&#x2F;etc&#x2F;nginx&#x2F;nginx.conf \</span><br><span class="line">-v $PWD&#x2F;html:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html \</span><br><span class="line">-e TZ&#x3D;Asia&#x2F;Shanghai \</span><br><span class="line">--name nginx \</span><br><span class="line">-d nginx:stable-alpine</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://zhangbasil.github.io/2020/05/02/jvm/synchronized/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.jpeg">
      <meta itemprop="name" content="zhangbasil">
      <meta itemprop="description" content="不积跬步，无以至千里；</br>不积小流，无以成江海。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Basil's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/02/jvm/synchronized/" class="post-title-link" itemprop="url">Synchronized关键字</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-02 19:05:29" itemprop="dateCreated datePublished" datetime="2020-05-02T19:05:29+08:00">2020-05-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E8%99%9A%E6%8B%9F%E6%9C%BA/" itemprop="url" rel="index">
                    <span itemprop="name">java虚拟机</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Synchronized关键字"><a href="#Synchronized关键字" class="headerlink" title="Synchronized关键字"></a>Synchronized关键字</h1><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><ul>
<li>多线程下同时访问同一个资源保证只有一个线程(Only one thread can execute at a time. )</li>
</ul>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><ul>
<li>作用在方法上面</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">" Hello World "</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>同步代码块上面</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//Only one thread can execute at a time. </span></span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="comment">// Access shared variables and other</span></span><br><span class="line">  		<span class="comment">// shared resources</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="原理推敲"><a href="#原理推敲" class="headerlink" title="原理推敲"></a>原理推敲</h4><ul>
<li><p>synchronized 是Java语言中的关键字，所以肯定是有JVM来帮我们做同步的</p>
<ul>
<li>JVM只会执行Java字节码</li>
</ul>
</li>
<li><p>了解Java 字节码</p>
<ul>
<li>同步指令</li>
</ul>
</li>
</ul>
<h4 id="官方规范"><a href="#官方规范" class="headerlink" title="官方规范"></a>官方规范</h4><blockquote>
<p>Method-level synchronization is performed implicitly, as part of method invocation and return (<a href="https://docs.oracle.com/javase/specs/jvms/se12/html/jvms-2.html#jvms-2.11.8" target="_blank" rel="noopener">§2.11.8</a>). A <code>synchronized</code> method is distinguished in the run-time constant pool’s <code>method_info</code> structure (<a href="https://docs.oracle.com/javase/specs/jvms/se12/html/jvms-4.html#jvms-4.6" target="_blank" rel="noopener">§4.6</a>) by the <code>ACC_SYNCHRONIZED</code> flag, which is checked by the method invocation instructions. When invoking a method for which <code>ACC_SYNCHRONIZED</code> is set, the executing thread enters a monitor, invokes the method itself, and exits the monitor whether the method invocation completes normally or abruptly. During the time the executing thread owns the monitor, no other thread may enter it. If an exception is thrown during invocation of the <code>synchronized</code> method and the <code>synchronized</code> method does not handle the exception, the monitor for the method is automatically exited before the exception is rethrown out of the <code>synchronized</code> method.</p>
</blockquote>
<ul>
<li>方法级的同步是隐式执行的，作为方法调用和返回的一部分</li>
</ul>
<blockquote>
<p>Synchronization of sequences of instructions is typically used to encode the <code>synchronized</code> block of the Java programming language. The Java Virtual Machine supplies the <em>monitorenter</em> and <em>monitorexit</em> instructions to support such language constructs. Proper implementation of <code>synchronized</code> blocks requires cooperation from a compiler targeting the Java Virtual Machine (<a href="https://docs.oracle.com/javase/specs/jvms/se12/html/jvms-3.html#jvms-3.14" target="_blank" rel="noopener">§3.14</a>).</p>
</blockquote>
<ul>
<li>同步代码块是通过 <em>monitorenter</em> 和 <em>monitorexit</em></li>
</ul>
<blockquote>
<p>Synchronization in the Java Virtual Machine is implemented by monitor entry and exit, either explicitly (by use of the <em>monitorenter</em> and <em>monitorexit</em> instructions) or implicitly (by the method invocation and return instructions).</p>
</blockquote>
<h4 id="代码实践"><a href="#代码实践" class="headerlink" title="代码实践"></a>代码实践</h4><ul>
<li>代码块显示的通过 <em>monitorenter</em>  和 <em>monitorexit</em> 指令</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">onlyMe</span><span class="params">(Foo foo)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (foo) &#123;</span><br><span class="line">        doSomething();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>javap -v SynchronizedQuestion.class</p>
<blockquote>
<p>  flags:<br>   Code:<br>     stack=2, locals=4, args_size=2<br>        0: aload_1<br>        1: dup<br>        2: astore_2<br>        3: ==monitorenter==                        // Enter the monitor associated with foo<br>        4: aload_0<br>        5: invokespecial #2                  // Method doSomething:()V<br>        8: aload_2<br>        9: ==monitorexit==                           // Exit the monitor associated with foo<br>       10: goto          18<br>       13: astore_3<br>       14: aload_2<br>       15: ==monitorexit==                        // Be sure to exit the monitor!<br>       16: aload_3<br>       17: athrow<br>       18: return<br>     Exception table:<br>        from    to  target type<br>            4    10    13   any<br>           13    16    13   any<br>     LineNumberTable:<br>       line 18: 0<br>       line 19: 4<br>       line 20: 8<br>       line 21: 18</p>
</blockquote>
<p>通过查看编译后的字节码发现会在整个代码块前后加上 <em>monitorenter</em> 和 <em>monitorexit</em></p>
<p>如若再深一步的追踪，会发现 hotspot 虚拟机是通过  <strong>cmpxchg （Compare and Exchange）</strong>指令来</p>
<h4 id="monitorenter"><a href="#monitorenter" class="headerlink" title="monitorenter"></a>monitorenter</h4><p>monitorenter 通过 cmpxchg （Compare and Exchange）指令</p>
<ul>
<li>方法级隐式</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sync</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    doSomething();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>synchronized void sync();<br> descriptor: ()V<br> flags: ==ACC_SYNCHRONIZED==<br> Code:<br>   stack=1, locals=1, args_size=1<br>      0: aload_0<br>      1: invokespecial #2                  // Method doSomething:()V<br>      4: return<br>   LineNumberTable:<br>     line 13: 0<br>     line 14: 4</p>
</blockquote>
<h4 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h4><hr>
<p><a href="https://docs.oracle.com/javase/specs/jvms/se12/html/jvms-2.html#jvms-2.11.10" target="_blank" rel="noopener">https://docs.oracle.com/javase/specs/jvms/se12/html/jvms-2.html#jvms-2.11.10</a></p>
<p><a href="https://docs.oracle.com/javase/specs/jvms/se12/html/jvms-3.html#jvms-3.14" target="_blank" rel="noopener">https://docs.oracle.com/javase/specs/jvms/se12/html/jvms-3.html#jvms-3.14</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://zhangbasil.github.io/2020/05/02/redis/redis-lettuce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.jpeg">
      <meta itemprop="name" content="zhangbasil">
      <meta itemprop="description" content="不积跬步，无以至千里；</br>不积小流，无以成江海。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Basil's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/02/redis/redis-lettuce/" class="post-title-link" itemprop="url">redis连接客户端lettuce</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-02 19:05:29" itemprop="dateCreated datePublished" datetime="2020-05-02T19:05:29+08:00">2020-05-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url" rel="index">
                    <span itemprop="name">中间件</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>github <a href="https://github.com/lettuce-io/lettuce-core" target="_blank" rel="noopener">Lettuce</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://zhangbasil.github.io/2020/05/02/redis/redis-command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.jpeg">
      <meta itemprop="name" content="zhangbasil">
      <meta itemprop="description" content="不积跬步，无以至千里；</br>不积小流，无以成江海。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Basil's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/02/redis/redis-command/" class="post-title-link" itemprop="url">Docker中相关Redis操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-02 19:05:29" itemprop="dateCreated datePublished" datetime="2020-05-02T19:05:29+08:00">2020-05-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url" rel="index">
                    <span itemprop="name">中间件</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><h4 id="Redis-客户端命令"><a href="#Redis-客户端命令" class="headerlink" title="Redis 客户端命令"></a>Redis 客户端命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h host -p port -a password</span><br><span class="line"></span><br><span class="line">-h 服务器地址 -p 端口号 -a 密码</span><br></pre></td></tr></table></figure>

<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><h4 id="创建并运行一个名为-redis-的容器"><a href="#创建并运行一个名为-redis-的容器" class="headerlink" title="创建并运行一个名为 redis 的容器"></a>创建并运行一个名为 <code>redis</code> 的容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">-p 6379:6379 \</span><br><span class="line">-e TZ=Asia/Shanghai  \</span><br><span class="line">-v <span class="variable">$PWD</span>/data:/data \</span><br><span class="line">-v <span class="variable">$PWD</span>/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">--name redis \</span><br><span class="line">-d redis redis-server /etc/redis/redis.conf</span><br></pre></td></tr></table></figure>
<h5 id="命令分解"><a href="#命令分解" class="headerlink" title="命令分解"></a>命令分解</h5><p>docker run <br>-p 6379:6379 \ # 端口映射 宿主机:容器<br>-v $PWD/data:/data:rw \ # 映射数据目录 rw 为读写<br>-v $PWD/conf/redis.conf:/etc/redis/redis.conf:ro \ # 挂载配置文件 ro 为readonly<br>-v /etc/localtime:/etc/localtime:ro \ # 容器时间为宿主机时间<br>–privileged=true \ # 给与一些权限<br>–name redis \ # 给容器起个名字<br>-d redis:3.2 redis-server /etc/redis/redis.conf # daemon 运行容器 并使用配置文件启动容器内的 redis-server <code>3.2</code> redis的版本</p>
<h4 id="链接Redis客户端"><a href="#链接Redis客户端" class="headerlink" title="链接Redis客户端"></a>链接Redis客户端</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it 3a64d9068558(container_id) redis-cli</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://zhangbasil.github.io/2020/05/02/jvm/cms-collector/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.jpeg">
      <meta itemprop="name" content="zhangbasil">
      <meta itemprop="description" content="不积跬步，无以至千里；</br>不积小流，无以成江海。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Basil's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/02/jvm/cms-collector/" class="post-title-link" itemprop="url">CMS垃圾收集器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-02 19:05:29" itemprop="dateCreated datePublished" datetime="2020-05-02T19:05:29+08:00">2020-05-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E8%99%9A%E6%8B%9F%E6%9C%BA/" itemprop="url" rel="index">
                    <span itemprop="name">java虚拟机</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Concurrent-Mark-Sweep-CMS-Collector"><a href="#Concurrent-Mark-Sweep-CMS-Collector" class="headerlink" title="Concurrent Mark Sweep (CMS) Collector"></a>Concurrent Mark Sweep (CMS) Collector</h3><ul>
<li>标记清除</li>
<li>作用在老年代</li>
</ul>
<h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><ul>
<li>初始标记</li>
<li>并发标记</li>
<li>重新标记</li>
<li>并发清除</li>
</ul>
<p>其中初始标记和重新标记需要 Stop The World</p>
<h4 id="并发标记"><a href="#并发标记" class="headerlink" title="并发标记"></a>并发标记</h4><ul>
<li>由于用户线程和垃圾收集器线程共存，用户线程不在引用某个对象，而垃圾收集器线程已经标记过，则会产生浮动垃圾</li>
<li>垃圾收集器线程扫描后是确定是垃圾，但是此时用户线程引用了这个对象，则这个对象就不能被回收</li>
</ul>
<p>浮动垃圾，不影响程序在下次GC的时候就会回收，而第二种情况则是使用了三色标记算法来解决</p>
<h4 id="三色标记"><a href="#三色标记" class="headerlink" title="三色标记"></a>三色标记</h4><p>白色：没有被垃圾收集器访问过。刚开始所有的对象都是白色的，若在分析结束还是白色，那么就会被回收</p>
<p>黑色：对象被垃圾收集器访问过，属于可达对象</p>
<p>灰色：对象已经被访问过，但这个对象上至少还有一个没被扫描过</p>
<p>More info: <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/cms.html" target="_blank" rel="noopener">CMS</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-cn">
    <link itemprop="mainEntityOfPage" href="https://zhangbasil.github.io/2020/05/02/jvm/jvm-options/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.jpeg">
      <meta itemprop="name" content="zhangbasil">
      <meta itemprop="description" content="不积跬步，无以至千里；</br>不积小流，无以成江海。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Basil's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/02/jvm/jvm-options/" class="post-title-link" itemprop="url">JVM options</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-02 19:05:29" itemprop="dateCreated datePublished" datetime="2020-05-02T19:05:29+08:00">2020-05-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E8%99%9A%E6%8B%9F%E6%9C%BA/" itemprop="url" rel="index">
                    <span itemprop="name">java虚拟机</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>java -XX:+PrintFlagsInitial 打印虚拟机是参数和初始值</p>
<h3 id="GC常用的参数"><a href="#GC常用的参数" class="headerlink" title="GC常用的参数"></a>GC常用的参数</h3><ul>
<li>-Xms<size>        设置初始化堆大小</li>
<li>-Xmx<size>        设置最大堆大小</li>
<li>-Xss<size>          set java thread stack size 设置线程栈大小</li>
<li>-Xmn<size>        新生代大小</li>
<li>-XX:+UseTLAB      使用TLAB（Thread Local Allocation Buffer）线程的本地缓冲区，默认打开</li>
<li>-XX:+PrintTLAB    打印TLAB的使用情况</li>
<li>-XX:TLABSize        设置TLAB的大小</li>
<li>-XX:+DisableExplicitGC 忽略手动调用GC的代码使得 System.gc()的调用就会变成一个空调用，完全不会触发任何GC</li>
<li>-XX:+PrintGC</li>
<li>-XX:+PrintGCDetails 打印gc日志</li>
<li>-XX:+PrintHeapAtGC</li>
</ul>
<p>-verbose:class </p>
<ul>
<li><p>-XX:+TraceClassLoading</p>
</li>
<li><p>-XX:+TraceClassUnLoading</p>
</li>
<li><p>-XX:+PrintGCDetails 打印gc日志</p>
</li>
<li><p>-XX:+UseParNewGC 使用ParNew垃圾收集器作为新生代</p>
</li>
</ul>
<h3 id="Parallel常用参数"><a href="#Parallel常用参数" class="headerlink" title="Parallel常用参数"></a>Parallel常用参数</h3><ul>
<li>-XX:SurvivorRatio</li>
<li>-XX:MaxTenuringThreshold=7 到达老年代的对象最大年龄值 PS 垃圾收集器默认是 15 </li>
<li>-XX:PretenureSizeThreshold     大对象到底有多大</li>
<li>-XX:+ParallelGCThreads        并发收集器的线程数，同样适用于CMS，一般设为和CPU核数相同</li>
<li>-XX:+UseAdaptiveSizePolicy    自动选择各区大小比例</li>
</ul>
<h3 id="CMS常用参数"><a href="#CMS常用参数" class="headerlink" title="CMS常用参数"></a>CMS常用参数</h3><ul>
<li><p>-XX:+UseConcMarkSweepGC     启用CMS收集器</p>
</li>
<li><p>-XX:+ParallelCMSThreads           CMS线程数量</p>
</li>
<li><p>-XX:CMSInitiatingOccupancyFraction   使用多少比例的来年的后开始CMS收集，默认是68%（近似值），如果频繁发生SerialOld卡顿，应该调小</p>
</li>
<li><p>-XX:+UseCMSCompactAtFullCollection     在FGC时进行压缩</p>
</li>
<li><p>-XX:CMSFullGCsBeforeCompaction         多次次FGC之后进行压缩</p>
</li>
<li><p>-XX:<u><em>CMSInitiatingPermOccupancyFraction</em></u>   达到什么比例时进行Perm回收</p>
</li>
<li><p>GCTimeRatio    设置GC时间占用程序运行时间的百分比</p>
</li>
</ul>
<h3 id="G1-常用参数"><a href="#G1-常用参数" class="headerlink" title="G1 常用参数"></a>G1 常用参数</h3><ul>
<li>-XX:+UseG1GC</li>
<li>-XX:MaxGCPauseMillis       </li>
<li>-XX:GCPauseIntervalMillis     GC的间隔时间</li>
<li>-XX:+G1HeapRegionSize   分区大小，建议逐渐增大该值，1 2 4 8 16 32   随着size增加，垃圾的存活时间更长，GC间隔更长，但每次GC的时间也会更长</li>
<li>G1NewSizePercent  新生代最小比例，默认5%</li>
<li>G1MaxNewSizePercent   新生代最大比例，默认60%</li>
<li>GCTimeRatio     GC时间</li>
<li>ConcGCThreads     线程数量</li>
<li>InitiatingHeapOccupancyPercent  启动G1的堆空间占用比例</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zhangbasil"
      src="/images/head.jpeg">
  <p class="site-author-name" itemprop="name">zhangbasil</p>
  <div class="site-description" itemprop="description">不积跬步，无以至千里；</br>不积小流，无以成江海。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">16</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhangbasil" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhangbasil" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hbsy_zhb@163.com" title="E-Mail → mailto:hbsy_zhb@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhangbasil</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.5.0
  </div>

        












        
      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>
    <script defer src="/lib/three/canvas_sphere.min.js"></script>


  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.js"></script>
<script src="/js/algolia-search.js"></script>





  <script>
    (function(d, w, c) {
      w.ChatraID = '';
      var s = d.createElement('script');
      w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
      };
      s.async = true;
      s.src = 'https://call.chatra.io/chatra.js';
      if (d.head) d.head.appendChild(s);
    })(document, window, 'Chatra');
  </script>










  

  

</body>
</html>
